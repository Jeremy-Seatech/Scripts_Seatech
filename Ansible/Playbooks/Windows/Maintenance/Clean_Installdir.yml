---
# Playbook pour exécuter du code PowerShell sur les machines Windows

- name: Exécution de commandes PowerShell sur les machines Windows
  hosts: all
  gather_facts: yes

  tasks:
    - name: Information de début
      ansible.windows.win_shell: |
        Write-Host "Début de l'exécution sur $(hostname)"
      register: debut

    - name: Afficher le résultat
      debug:
        var: debut.stdout_lines

    # ========================================
    # SECTION À PERSONNALISER
    # Ajoutez votre code PowerShell ici
    # ========================================

    - name: Clean_Installdir
      ansible.windows.win_shell: |
        $folderPath = "C:\install"
  
          # VÃ©rifie si le dossier existe
          if (Test-Path $folderPath) {
              # Supprime le dossier et son contenu
              Remove-Item -Path $folderPath -Recurse -Force
              Write-Host "Le dossier $folderPath a Ã©tÃ© supprimÃ© avec succÃ¨s."
          } else {
              Write-Host "Le dossier $folderPath n'existe pas."
          }

      register: resultat_custom

    - name: Afficher les résultats de votre script
      debug:
        var: resultat_custom.stdout_lines

    # ========================================
    # FIN DE LA SECTION À PERSONNALISER
    # ========================================

    - name: Information de fin
      ansible.windows.win_shell: |
        Write-Host "Fin de l'exécution sur $(hostname)"
      register: fin

    - name: Afficher le message de fin
      debug:
        var: fin.stdout_lines
